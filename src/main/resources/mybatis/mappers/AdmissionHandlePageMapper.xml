<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<!--특정 환자 간호기록 READ-->

<mapper namespace="com.douzone.HISservice.repository.AdmissionHandlePageDAO">
    <select id="getCareInfo" parameterType="HashMap" resultType="HashMap">
        SELECT CARE_DATE, NURSE_NAME, CARE_CONTENT
        FROM care_tb AS a
                 LEFT JOIN admission_tb AS b ON a.ADMISSION_ID_FK = b.ADMISSION_ID_PK
                 LEFT JOIN treatment_info_tb AS c ON b.TREATMENT_NUM_PK = c.TREATMENT_NUM_PK
                 LEFT JOIN patient_tb AS d ON c.PATIENT_ID_FK = d.PATIENT_ID_PK
                 LEFT JOIN admission_status AS e ON b.ADMISSION_STATUS_CODE = e.ADMISSION_STATUS_CODE
        WHERE d.PATIENT_NAME = #{name} AND e.AD_CODE_NAME = #{adCodeName} AND b.WARD = #{ward} AND b.ROOM_NUM = #{roomNum} AND b.BED_NUM= #{bedNum}
        ORDER BY CARE_ID_PK DESC;
    </select>
    <!--특정 환자 간호기록 CREATE-->
    <insert id="setCareInfo" parameterType="HashMap">
        INSERT INTO CARE_TB
        VALUES
            ( (SELECT concat('C',(SELECT 22000001 + (SELECT COUNT(*) FROM CARE_TB AS a)))),
              (SELECT ADMISSION_ID_PK FROM admission_tb AS b
                                               LEFT JOIN admission_status AS c ON b.ADMISSION_STATUS_CODE = c.ADMISSION_STATUS_CODE
                                               LEFT JOIN TREATMENT_INFO_TB AS d ON b.TREATMENT_NUM_PK = d.TREATMENT_NUM_PK
                                               LEFT JOIN patient_tb AS e ON d.PATIENT_ID_FK = e.PATIENT_ID_PK
               WHERE e.PATIENT_NAME = #{name} AND c.AD_CODE_NAME = #{adCodeName} AND b.WARD = #{ward} AND b.ROOM_NUM = #{roomNum} AND b.BED_NUM= #{bedNum}),
              now(),#{nurseName}, #{careContent});
    </insert>
</mapper>


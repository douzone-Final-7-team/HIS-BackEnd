<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">



<mapper namespace="com.douzone.HISservice.repository.OutStatusDAO">
    <!--환자 현황 READ-->
    <select id="getOutStatus" parameterType="HashMap" resultType="HashMap">
        SELECT c.PATIENT_NAME 'patName', DATE_FORMAT(a.REGISTRATION_TIME,'%H : %i') 'regTime', d.OP_CODE_NAME 'status', a.RECEIVE_ID_PK 'receiveId', c.PATIENT_SSN
        FROM RECEIVE_TB AS a
                 LEFT JOIN EMP_INFO_TB AS b ON b.EMP_ID_PK = a.EMP_ID_FK
                 LEFT JOIN PATIENT_TB AS c ON c.PATIENT_ID_PK = a.PATIENT_ID_FK
                 LEFT JOIN OUTPATIENT_STATUS AS d ON d.OUTPATIENT_STATUS_CODE = a.OUTPATIENT_STATUS_CODE
        WHERE b.EMP_ID_PK = #{EMP_ID_PK}

          AND (d.OUTPATIENT_STATUS_CODE = 'OA' OR d.OUTPATIENT_STATUS_CODE = 'OB' OR d.OUTPATIENT_STATUS_CODE = 'OC' OR d.OUTPATIENT_STATUS_CODE = 'OE')
          AND DATE_FORMAT(a.REGISTRATION_TIME, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        ORDER BY d.OUTPATIENT_STATUS_CODE;
    </select>


    <!-- 접수 INSERT -->
    <insert id="insertReceiveInfo" parameterType="Map">
        INSERT INTO RECEIVE_TB
        (RECEIVE_ID_PK,
         PATIENT_ID_FK,
         OUTPATIENT_STATUS_CODE,
         EMP_ID_FK,
         SYMPTOM,
         REGISTRATION_TIME,
         SPECIALITY)
        VALUES (#{RECEIVE_ID_PK},
                #{PATIENT_ID_PK},
                'OA',
                #{EMP_ID_PK},
                #{SYMPTOM},
                NOW(),
                #{SPECIALITY});
    </insert>


    <!-- 접수번호 id(R22~~) 찾기 -->
    <select id="getRecentSeq" parameterType="String" resultType="String">
        SELECT RECEIVE_ID_PK
        FROM RECEIVE_TB
        WHERE RECEIVE_ID_PK
                  LIKE
              '${currYr}%'
        ORDER BY RECEIVE_ID_PK
                DESC LIMIT 1;
    </select>


    <!-- 과 별 의사 리스트와 해당 의사들의 환자 현황 SELECT -->
    <select id="getDoctorList" parameterType="HashMap" resultType="HashMap">
        SELECT EMP_NAME, EMP_ID_PK, SPECIALITY_ID_PK
        FROM EMP_INFO_TB AS a
                 LEFT JOIN SPECIALITY_TB AS b ON b.SPECIALITY_ID_PK = a.SPECIALITY_ID_FK
        WHERE SPECIALITY_ID_FK = #{SPECIALITY_ID_FK}
          AND EMP_ID_PK LIKE 'D%';
    </select>


    <!-- 수납 금액 SELECT -->

</mapper>
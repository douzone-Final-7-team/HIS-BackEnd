<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<!--특정 환자 입원 정보 READ-->
<mapper namespace="com.douzone.HISservice.repository.PatientInfoDAO">
    <select id="getPatientInfo" parameterType="HashMap" resultType="HashMap">
        SELECT ADMISSION_ID_PK, ADMISSION_DATE, ADMISSION_DUEDATE, DISCHARGE_DUEDATE, PATIENT_NAME, GENDER, PATIENT_ADDR, PATIENT_TEL, DIAGNOSTIC_NAME, EMP_NAME, SPECIALITY_NAME,PROTECTOR_NAME,PROTECTOR_TEL
        FROM ADMISSION_TB AS a
                 LEFT JOIN TREATMENT_INFO_TB AS b ON a.TREATMENT_NUM_FK = b.TREATMENT_NUM_PK
                 LEFT JOIN PATIENT_TB AS c ON b.PATIENT_ID_FK = c.PATIENT_ID_PK
                 LEFT JOIN EMP_INFO_TB AS d ON b.EMP_ID_FK = d.EMP_ID_PK
                 LEFT JOIN SPECIALITY_TB AS e ON d.SPECIALITY_ID_FK= e.SPECIALITY_ID_PK
                 LEFT JOIN ADMISSION_STATUS AS f ON a.ADMISSION_STATUS_CODE = f.ADMISSION_STATUS_CODE
        WHERE c.PATIENT_NAME = #{name} AND f.AD_CODE_NAME = '입원완료' AND a.WARD = #{ward} AND a.ROOM_NUM = #{roomNum} AND a.BED_NUM= #{bedNum};
    </select>
    <!--퇴원 예정일 UPDATE -->
    <update id="changeDischargeDueDate" parameterType="HashMap">
        UPDATE
            ADMISSION_TB AS a
        SET a.DISCHARGE_DUEDATE = #{dischargeDueDate}
        WHERE ADMISSION_ID_PK = #{admissionIdPk};
    </update>

    <select id="getPastTreatment" resultType="HashMap">
        SELECT TREATMENT_DATE, DIAGNOSTIC_NAME
        FROM TREATMENT_INFO_TB
        WHERE PATIENT_ID_FK = '22110004';
    </select>



</mapper>